<!doctype html>
<html lang="es">
<head>
  <link rel="icon" type="image/png" href="Imagenes/favicon.png">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NailGrace</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  
  <div class="site container" id="home">
    <div class="topbar">P√°gina de inicio</div>

    <header class="header">
        <img src="Imagenes\logo.png" alt="NailGrace logo" height="50">

        <button class="menu-toggle" aria-label="Abrir men√∫">&#9776;</button>

        <nav class="mainnav">
          <a href="#home" class="active">Inicio</a>
          <a href="#services">Servicios</a>
          <a href="#register">Registro</a>
          <a href="#login">Iniciar sesi√≥n</a>
          <a href="#" class="reserve-link" data-reserve>Reservar cita</a>
        </nav>
      
    </header>

    <section class="hero">
      <div class="hero-grid">
        <div>
          <h1>Belleza y cuidado para tus u√±as</h1>
          <p>Manicura, pedicure y productos seleccionados para mantener tus manos y pies saludables y bonitos.</p>
          <div class="hero-ctas">
            <button data-reserve class="btn btn-primary" onclick="navigateTo('services')">Reserva tu cita</button>
            <button class="btn btn-light" onclick="navigateTo('services')">Ver servicios</button>
          </div>
        </div>

        <div class="hero-visual">
          <div class="thumb"><img src="Imagenes\logo1.jpg" alt="Miniatura" class="thumb-img"></div>
          <div class="thumb"><img src="Imagenes\logo2.jpg" alt="Miniatura" class="thumb-img"></div>
          <div class="thumb"><img src="Imagenes\logo3.jpg" alt="Miniatura" class="thumb-img"></div>
        </div>
      </div>
    </section>

    <h2 style="width:95%;max-width:var(--max-desktop);margin:20px auto 10px;">¬øC√≥mo cuidar tus u√±as?</h2>

    <section class="tips-section">
      <!-- Flecha izquierda -->
      <button class="arrow left" aria-label="Anterior" onclick="moveSlide(-1)">‚Äπ</button>

      <!-- Carrusel -->
      <div class="tips-wrapper">
        <div class="tips-list" id="tipsList" aria-label="Consejos para las u√±as">
          
          <article class="tip-item">
            <div class="tip-img"><img src="Imagenes\comeru√±as.jpg" alt="Consejo imagen" class="tip-img-el"></div>
            <div class="tip-text">
              <h3>No morderte las u√±as.</h3>
              <p>Morder las u√±as debilita la l√°mina ungueal y puede causar infecciones. 
                Usa t√©cnicas de manejo de estr√©s y mant√©n las u√±as limadas.</p>
              <button data-reserve class="btn btn-primary">Reserva tu cita</button>
            </div>
          </article>

          <article class="tip-item">
            <div class="tip-img"><img src="Imagenes\retocar.jpg" alt="Consejo imagen" class="tip-img-el"></div>
            <div class="tip-text">
              <h3>Retocar cada 21‚Äì25 d√≠as</h3>
              <p>El mantenimiento regular ayuda a mantener la forma y evita roturas.</p>
              <button data-reserve class="btn btn-primary">Reserva tu cita</button>
            </div>
          </article>

          <article class="tip-item">
            <div class="tip-img"><img src="Imagenes\arrancar.jpg" alt="Consejo imagen" class="tip-img-el"></div>
            <div class="tip-text">
              <h3>No arrancar gel o acr√≠lico.</h3>
              <p>Ret√≠ralos con la ayuda de un profesional para no da√±ar la l√°mina ungueal.</p>
              <button data-reserve class="btn btn-primary">Reserva tu cita</button>
            </div>
          </article>

          <article class="tip-item">
            <div class="tip-img"><img src="Imagenes\guantes.jpg" alt="Consejo imagen" class="tip-img-el"></div>
            <div class="tip-text">
              <h3>Usar guantes para proteger tus u√±as.</h3>
              <p>Al realizar tareas de limpieza o manipular qu√≠micos, protege tus u√±as 
                con guantes adecuados para evitar da√±os.</p>
              <button data-reserve class="btn btn-primary">Reserva tu cita</button>
            </div>
          </article>

          <article class="tip-item">
            <div class="tip-img"><img src="Imagenes\herramientas.jpg" alt="Consejo imagen" class="tip-img-el"></div>
            <div class="tip-text">
              <h3>No usarlas como herramienta.</h3>
              <p>Evita abrir objetos o raspar superficies con tus u√±as, ya que esto las debilita 
                y puede causar desprendimiento del esmalte.</p>
              <button data-reserve class="btn btn-primary">Reserva tu cita</button>
            </div>
          </article>

          <article class="tip-item">
            <div class="tip-img"><img src="Imagenes\rota.jpg" alt="Consejo imagen" class="tip-img-el"></div>
            <div class="tip-text">
              <h3>Acudir a tu manicurista en caso de desprendimiento.</h3>
              <p>Si notas que el esmalte comienza a levantarse, visita tu manicurista 
                para una reparaci√≥n adecuada y evitar da√±os mayores.</p>
              <button data-reserve class="btn btn-primary">Reserva tu cita</button>
            </div>
          </article>
        </div>
      </div>

      <!-- Flecha derecha -->
      <button class="arrow right" aria-label="Siguiente" onclick="moveSlide(1)">‚Ä∫</button>
    </section>

    <footer class="site-footer">
        <div class="footer-grid">
          <div>
            <h4>Cont√°ctanos</h4>
            <ul>
              <li><i>tel</i> +57 321 226 0538</li>
              <li><i>gm</i> nailgrace_25@gmail.com</li>
            </ul>
          </div>
          <div>
            <h4>Nuestros Servicios</h4>
            <ul>
              <li><i>cor</i>Manicure</li>
              <li><i>cor</i>Pedicure</li>
              <li><i>cor</i>Esmaltado semipermanente</li>
            </ul>
          </div>
          <div>
            <h4>Redes Sociales</h4>
            <ul>
              <li><i>ig</i> @Nails_Grace</li>
              <li><i>fac</i> @Nails_Grace</li>
              <li><i>tik</i> @Nails_Grace</li>
            </ul>
          </div>
        </div>
        <div class="footer-bottom">
          ¬© 2025 NailGrace ¬∑ Pol√≠tica de privacidad ¬∑ T√©rminos
        </div>
    </footer>
  </div>

  <!-- ===== SERVICES (con 3 servicios + footer) ===== -->
  <div class="site container" id="services">
    <div class="topbar">P√°gina de Servicios</div>
    <header class="header">
      <img src="Imagenes/logo.png" alt="NailGrace logo" height="50">
      <button class="menu-toggle" aria-label="Abrir men√∫">&#9776;</button>
      <nav class="mainnav">
        <a href="#home" class="active">Inicio</a>
        <a href="#services">Servicios</a>
        <a href="#register">Registro</a>
        <a href="#login">Iniciar sesi√≥n</a>
        <a href="#" class="reserve-link" data-reserve>Reservar cita</a>
      </nav>
    </header>

    <div class="services-inner">
      <h2 style="margin:0 0 12px;">Servicios</h2>

      <section class="services-list">
        <!-- Servicio 1 -->
        <article class="service-card">
          <div class="service-media"><img src="Imagenes\u√±asclasico.jpg" alt="Manicure" class="service-img"></div>
          <div>
            <h3>Manicure cl√°sico</h3>
            <p class="muted">Corte, limado y esmaltado tradicional para mantener tus u√±as en forma.</p>
            <div class="service-cta"><button data-reserve class="btn btn-primary" data-reserve data-service-name="Manicure cl√°sico" data-price="25000">Reserva tu cita</button></div>
          </div>
        </article>

        <!-- Servicio 2 -->
        <article class="service-card">
          <div>
            <h3>Pedicure cl√°sico</h3>
            <p class="muted">Relajaci√≥n y cuidado completo de pies, con limpieza, exfoliaci√≥n y esmaltado.</p>
            <div class="service-cta"><button data-reserve class="btn btn-primary" data-reserve data-service-name="Pedicure cl√°sico" data-price="35000">Reserva tu cita</button></div>
          </div>
          <div class="service-media"><img src="Imagenes\pies.jpg" alt="Pedicure" class="service-img"></div>
        </article>

        <!-- Servicio 3 -->
        <article class="service-card">
          <div class="service-media"><img src="Imagenes\perma.jpg" alt="Esmaltado semipermanente" class="service-img"></div>
          <div>
            <h3>Esmaltado semipermanente</h3>
            <p class="muted">Color de larga duraci√≥n, brillo intenso y resistencia hasta por semanas.</p>
            <div class="service-cta"><button data-reserve class="btn btn-primary" data-reserve data-service-name="Esmaltado semipermanente" data-price="40000">Reserva tu cita</button></div>
          </div>
        </article>
      </section>
    </div>
    <footer class="site-footer">
        <div class="footer-grid">
          <div>
            <h4>Cont√°ctanos</h4>
            <ul>
              <li><i>tel</i> +57 321 226 0538</li>
              <li><i>gm</i> nailgrace_25@gmail.com</li>
            </ul>
          </div>
          <div>
            <h4>Nuestros Servicios</h4>
            <ul>
              <li><i>cor</i>Manicure</li>
              <li><i>cor</i>Pedicure</li>
              <li><i>cor</i>Esmaltado semipermanente</li>
            </ul>
          </div>
          <div>
            <h4>Redes Sociales</h4>
            <ul>
              <li><i>ig</i> @Nails_Grace</li>
              <li><i>fac</i> @Nails_Grace</li>
              <li><i>tik</i> @Nails_Grace</li>
            </ul>
          </div>
        </div>
        <div class="footer-bottom">
          ¬© 2025 NailGrace ¬∑ Pol√≠tica de privacidad ¬∑ T√©rminos
        </div>
    </footer>
  </div>

  <!-- ===== LOGIN (ocupa casi toda la pantalla) ===== -->
  <div class="site auth-viewport" id="login" style="display:none;">
    <div class="topbar">Inicio de sesi√≥n</div>
    <header class="header">
      <img src="Imagenes/logo.png" alt="NailGrace logo" height="50">
      <button class="menu-toggle" aria-label="Abrir men√∫">&#9776;</button>
      <nav class="mainnav">
        <a href="#home" class="active">Inicio</a>
        <a href="#services">Servicios</a>
        <a href="#register">Registro</a>
        <a href="#login">Iniciar sesi√≥n</a>
        <a href="#" class="reserve-link" data-reserve>Reservar cita</a>
      </nav>
    </header>

    <div class="auth-page" role="main" aria-label="Iniciar sesi√≥n">
      <div class="auth-left">
        <div class="text">
          <h2>Inicia sesi√≥n para disfrutar de nuestros servicios</h2>
          <p class="muted">Accede para reservar y disfrutar de mas servicios.</p>
        </div>
      </div>

      <div>
        <div class="auth-card" style="width:420px;">
          <h3>NailGrace</h3>
          <input type="email" placeholder="Correo electr√≥nico" aria-label="Correo electr√≥nico">
          <input type="password" placeholder="Contrase√±a" aria-label="Contrase√±a">
          <button class="btn btn-primary" style="width:100%;">Continuar</button>
          <p class="muted" style="font-size:13px; text-align:center; margin-top:8px;">¬øNo tienes cuenta? <a href="#register" onclick="navigateTo('register')">Reg√≠strate</a></p>
        </div>
      </div>
      
    </div>
    <footer class="site-footer">
        <div class="footer-grid">
          <div>
            <h4>Cont√°ctanos</h4>
            <ul>
              <li><i>tel</i> +57 321 226 0538</li>
              <li><i>gm</i> nailgrace_25@gmail.com</li>
            </ul>
          </div>
          <div>
            <h4>Nuestros Servicios</h4>
            <ul>
              <li><i>cor</i>Manicure</li>
              <li><i>cor</i>Pedicure</li>
              <li><i>cor</i>Esmaltado semipermanente</li>
            </ul>
          </div>
          <div>
            <h4>Redes Sociales</h4>
            <ul>
              <li><i>ig</i> @Nails_Grace</li>
              <li><i>fac</i> @Nails_Grace</li>
              <li><i>tik</i> @Nails_Grace</li>
            </ul>
          </div>
        </div>
        <div class="footer-bottom">
          ¬© 2025 NailGrace ¬∑ Pol√≠tica de privacidad ¬∑ T√©rminos
        </div>
    </footer>
  </div>

  <!-- ===== REGISTER (ocupa casi toda la pantalla) ===== -->
  <div class="site auth-viewport" id="register" style="display:none;">
    <div class="topbar">Registro</div>

    <header class="header">
      <img src="Imagenes/logo.png" alt="NailGrace logo" height="50">
      <button class="menu-toggle" aria-label="Abrir men√∫">&#9776;</button>
      <nav class="mainnav">
        <a href="#home" class="active">Inicio</a>
        <a href="#services">Servicios</a>
        <a href="#register">Registro</a>
        <a href="#login">Iniciar sesi√≥n</a>
        <a href="#" class="reserve-link" data-reserve>Reservar cita</a>
      </nav>
    </header>

    <div class="auth-page" role="main" aria-label="Registro">
      <div class="auth-left">
        <div class="text">
          <h2>¬°Bienvenido! Crea tu cuenta</h2>
          <p class="muted">Reg√≠strate para reservar m√°s r√°pido y cuidar tus u√±as.</p>
        </div>
      </div>

      <div>
        <div class="auth-card" style="width:420px;">
          <h3>NailGrace</h3>
          <input type="email" placeholder="Correo electr√≥nico" aria-label="Correo electr√≥nico">
          <input type="password" placeholder="Contrase√±a" aria-label="Contrase√±a">
          <button class="btn btn-primary" style="width:100%;">Continuar</button>
          <p class="muted" style="font-size:13px; text-align:center; margin-top:8px;">¬øYa eres miembro? <a href="#login" onclick="navigateTo('login')">Iniciar sesi√≥n</a></p>
        </div>
      </div>
    </div>
    <footer class="site-footer">
        <div class="footer-grid">
          <div>
            <h4>Cont√°ctanos</h4>
            <ul>
              <li><i>tel</i> +57 321 226 0538</li>
              <li><i>gm</i> nailgrace_25@gmail.com</li>
            </ul>
          </div>
          <div>
            <h4>Nuestros Servicios</h4>
            <ul>
              <li><i>cor</i>Manicure</li>
              <li><i>cor</i>Pedicure</li>
              <li><i>cor</i>Esmaltado semipermanente</li>
            </ul>
          </div>
          <div>
            <h4>Redes Sociales</h4>
            <ul>
              <li><i>ig</i> @Nails_Grace</li>
              <li><i>fac</i> @Nails_Grace</li>
              <li><i>tik</i> @Nails_Grace</li>
            </ul>
          </div>
        </div>
        <div class="footer-bottom">
          ¬© 2025 NailGrace ¬∑ Pol√≠tica de privacidad ¬∑ T√©rminos
        </div>
    </footer>
  </div>

  <script>
    // ======== Navegaci√≥n entre secciones ========
    const sections = ["home","services","login","register"];

    function showSection(id){
      // Ocultar/mostrar secciones
      sections.forEach(s => {
        const el = document.getElementById(s);
        if(!el) return;
        el.style.display = (s === id) ? "" : "none";
      });

      // üîπ Actualizar el estado activo en todos los men√∫s
      document.querySelectorAll('header .mainnav a').forEach(link => {
        const href = link.getAttribute('href') || '';
        if (href.includes(id)) {
          link.classList.add('active');
        } else {
          link.classList.remove('active');
        }
      });

      // Volver al inicio visual
      window.scrollTo({top:0, behavior:'instant'});
    }

    function navigateTo(id){
      location.hash = id;
      showSection(id);
    }

    window.addEventListener('hashchange', ()=> {
      const id = location.hash.replace('#','') || 'home';
      if(sections.includes(id)) showSection(id);
    });

    // inicializar vista
    showSection(location.hash.replace('#','') || 'home');

/* ===== Simulaci√≥n visual de registro / inicio de sesi√≥n =====
   - Cuando el usuario haga click en "Continuar" dentro de #register o #login,
     simulamos que qued√≥ logueado, redirigimos a 'home' y actualizamos el nav
     para mostrar: Inicio, Servicios, Reservar cita y un √≠cono de Perfil.
   - Estado persistente en localStorage bajo clave 'ng_user_logged_in'
*/
(function(){
  const AUTH_KEY = 'ng_user_logged_in';

// --- Desarrollo: forzar estado logged-out al abrir localmente o con ?resetAuth=1
try{
  if(location.protocol === 'file:' || location.hostname === 'localhost' || location.search.indexOf('resetAuth=1') !== -1){
    localStorage.removeItem('ng_user_logged_in');
  }
} catch(e){}


  function isLoggedIn(){
    try { return localStorage.getItem(AUTH_KEY) === '1'; }
    catch(e){ return false; }
  }

  function setLoggedIn(flag){
    try { localStorage.setItem(AUTH_KEY, flag ? '1' : '0'); }
    catch(e){ /* ignore */ }
    updateNavForAuth();
  }

  

function updateNavForAuth(){
  const headerNavs = document.querySelectorAll('header .mainnav');
  if(!headerNavs || headerNavs.length === 0) return;

  headerNavs.forEach(mainNav => {
    const existingProfile = mainNav.querySelector('.ng-profile-link');
    if(existingProfile) existingProfile.remove();

    const links = Array.from(mainNav.querySelectorAll('a'));
    links.forEach(a => {
      const href = (a.getAttribute('href') || '').toLowerCase();
      if(isLoggedIn()){
        if(href.includes('register') || href.includes('login')){
          a.style.display = 'none';
        }
      } else {
        if(href.includes('register') || href.includes('login')){
          a.style.display = '';
        }
      }
    });

    let reserveLink = mainNav.querySelector('[data-reserve], .reserve-link, a[href="#reservar"], a.reserve-link');
    if(!reserveLink){
      const a = document.createElement('a');
      a.href = '#reservar';
      a.className = 'reserve-link';
      a.setAttribute('data-reserve','');
      a.textContent = 'Reservar cita';
      mainNav.appendChild(a);
      reserveLink = a;
    } else {
      reserveLink.style.display = '';
    }

    if(isLoggedIn()){
      if(!mainNav.querySelector('.ng-profile-link')){
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'ng-profile-link';
        btn.title = 'Perfil';
        btn.setAttribute('aria-label','Perfil');
        btn.innerHTML = '<span style="display:inline-block;width:36px;height:36px;border-radius:50%;background:linear-gradient(90deg,#ff5aa6,#ec4899);box-shadow:0 6px 18px rgba(236,72,153,0.12);"></span>';
        mainNav.appendChild(btn);
      }
    }
  });
}
function bindAuthForms(){
    const reg = document.getElementById('register');
    const log = document.getElementById('login');
    if(reg){
      const btn = reg.querySelector('.btn-primary');
      if(btn){
        btn.addEventListener('click', function(e){
          e.preventDefault();
          // simulate register success
          setLoggedIn(true);
          navigateTo('home');
        });
      }
    }
    if(log){
      const btn2 = log.querySelector('.btn-primary');
      if(btn2){
        btn2.addEventListener('click', function(e){
          e.preventDefault();
          // simulate login success
          setLoggedIn(true);
          navigateTo('home');
        });
      }
    }
  }

  // Expose a logout helper (not visible UI)
  window.ngLogout = function(){
    setLoggedIn(false);
    navigateTo('home');
  };

  // Initialize on DOM ready - update nav according to current state and bind forms
  document.addEventListener('DOMContentLoaded', function(){
    updateNavForAuth();
    bindAuthForms();
  });

  // Also update nav when showing sections (in case navs are duplicated inside auth pages)
  const originalShow = window.showSection;
  if(typeof originalShow === 'function'){
    window.showSection = function(id){
      originalShow(id);
      updateNavForAuth();
      bindAuthForms();
    };
  }

})();




    // ======== Carrusel de tips ========
    const list = document.getElementById("tipsList");
    const items = document.querySelectorAll(".tip-item");
    const total = items.length;
    let currentSlide = 0;

    function moveSlide(direction) {
      // Actualiza el √≠ndice seg√∫n la direcci√≥n (-1 = anterior, +1 = siguiente)
      currentSlide = (currentSlide + direction + total) % total;
      // Mueve el carrusel
      list.style.transform = `translateX(-${currentSlide * 100}%)`;
    }


    // ======== Men√∫ hamburguesa ========
    
  document.querySelectorAll('.header').forEach(header => {
    const toggle = header.querySelector('.menu-toggle');
    const nav = header.querySelector('.mainnav');

    if (toggle && nav) {
      // Evento para abrir/cerrar men√∫
      toggle.addEventListener('click', () => {
        toggle.classList.toggle('active');
        nav.classList.toggle('active');
        toggle.innerHTML = toggle.classList.contains('active') ? '‚úï' : '&#9776;';
      });

      // Cierra el men√∫ al hacer clic en un enlace
      nav.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
          nav.classList.remove('active');
          toggle.classList.remove('active');
          toggle.innerHTML = '&#9776;';
        });
      });
    }
  });

  </script>

<!-- === NG-BOOKING: Modal de reservas (a√±adido, encapsulado) ===
     Nota: No cambia el estilo global. Para que el modal funcione,
     a√±ade atributos data-reserve en los botones que deban abrirlo,
     por ejemplo:
     <button data-reserve data-service-name="Manicure cl√°sico" data-price="25000">Reserva tu cita</button>
     Y enlaza tu archivo JS (booking.js) con: <script src="booking.js" defer></script>
-->
<div class="ng-booking-modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="ng-booking-title" data-ng-booking>
  <div class="ng-booking-overlay" data-ng-close></div>

  <div class="ng-booking-dialog" role="document" tabindex="-1">
    <header class="ng-booking-header">
      <h2 id="ng-booking-title">Reservar cita</h2>
      <button class="ng-booking-close" aria-label="Cerrar" data-ng-close>‚úï</button>
    </header>

    <main class="ng-booking-body">
      <!-- pasos -->
      <ol class="ng-booking-steps" aria-hidden="false">
        <li data-step="1" class="ng-step-ind">1. Fecha y hora</li>
        <li data-step="2" class="ng-step-ind">2. Servicios</li>
        <li data-step="3" class="ng-step-ind">3. Confirmar</li>
      </ol>

      <!-- Paso 1 -->
      <section class="ng-step" data-step="1">
        <label for="ng-date">Fecha
          <input id="ng-date" type="date" aria-label="Fecha de la cita">
        </label>
        <label for="ng-time">Hora
          <input id="ng-time" type="time" aria-label="Hora de la cita" step="900">
        </label>

        <div class="ng-actions">
          <button type="button" class="ng-btn ng-btn-light" data-ng-cancel>Cancelar</button>
          <button type="button" class="ng-btn ng-btn-primary" data-ng-next>Continuar</button>
        </div>
      </section>

      <!-- Paso 2 -->
      <section class="ng-step" data-step="2" hidden>
        <div class="ng-services-wrap">
          <div id="ng-services-list" class="ng-services-list" aria-label="Servicios disponibles" role="list">
            <!-- renderizado por JS -->
          </div>

          <aside class="ng-cart" aria-label="Resumen">
            <h4>Resumen</h4>
            <ul id="ng-cart-list" aria-live="polite"></ul>
            <div class="ng-cart-total">Total: <strong id="ng-cart-total">‚Äî</strong></div>

            <div class="ng-actions">
              <button type="button" class="ng-btn ng-btn-light" data-ng-back>Volver</button>
              <button type="button" class="ng-btn ng-btn-primary" data-ng-next>Continuar</button>
            </div>
          </aside>
        </div>
      </section>

      <!-- Paso 3 -->
      <section class="ng-step" data-step="3" hidden>
        <div id="ng-confirm" aria-live="polite"></div>
        <div class="ng-actions">
          <button type="button" class="ng-btn ng-btn-light" data-ng-back>Volver</button>
          <button type="button" class="ng-btn ng-btn-primary" data-ng-confirm>Confirmar</button>
        </div>
      </section>
    </main>
  </div>
</div>
<!-- === FIN modal NG === -->


<script>
/* booking-modal (encapsulado) - inline */
(function(){
  const defaultServices = [
    { id:'svc-manicure', name:'Manicure cl√°sico', price:25000 },
    { id:'svc-pedicure', name:'Pedicure cl√°sico', price:35000 },
    { id:'svc-esmaltado', name:'Esmaltado semipermanente', price:40000 }
  ];
  const modal = document.querySelector('[data-ng-booking]');
  if(!modal) return;
  const dialog = modal.querySelector('.ng-booking-dialog');
  const overlay = modal.querySelector('.ng-booking-overlay');
  const dateEl = modal.querySelector('#ng-date');
  const timeEl = modal.querySelector('#ng-time');
  const servicesListEl = modal.querySelector('#ng-services-list');
  const cartListEl = modal.querySelector('#ng-cart-list');
  const cartTotalEl = modal.querySelector('#ng-cart-total');
  const confirmEl = modal.querySelector('#ng-confirm');

  let step = 1;
  let selected = new Map();
  let lastTrigger = null;

  const fmt = v => new Intl.NumberFormat('es-CO', { style:'currency', currency:'COP' }).format(v);

  
function openModal(trigger){
  lastTrigger = trigger || null;
  modal.setAttribute('aria-hidden','false');
  dialog.focus();

  // limpiamos selecci√≥n inicial y renderizamos (para evitar restos previos)
  selected.clear();
  renderServices();
  renderCart();

  // si el trigger tiene datos de servicio, pre-seleccionamos el servicio
  if(trigger && trigger.dataset && trigger.dataset.serviceName){
    const svc = { id:'pre-'+Date.now(), name: trigger.dataset.serviceName, price: Number(trigger.dataset.price||0) };
    selected.set(svc.id, svc);
    renderCart();
    renderServices();
    // IMPORTANTE: no hacemos `goStep(2)` aqu√≠ ‚Äî siempre empezamos en paso 1 (fecha/hora)
  }

  // Siempre empezar en paso 1
  goStep(1);
}
  
function closeModal(){
  modal.setAttribute('aria-hidden','true');
  selected.clear();
  if(dateEl) dateEl.value='';
  if(timeEl) timeEl.value='';
  renderServices();
  renderCart();
  if(confirmEl) confirmEl.innerHTML='';

  // Restaurar los botones originales del paso 3 (por si fueron reemplazados por "Cerrar")
  const s3ActionsContainer = modal.querySelector('.ng-step[data-step="3"] .ng-actions');
  if(s3ActionsContainer && typeof _ng_step3_actions !== 'undefined' && _ng_step3_actions) {
    s3ActionsContainer.innerHTML = _ng_step3_actions;
  }

  if(lastTrigger && typeof lastTrigger.focus === 'function') lastTrigger.focus();
  lastTrigger = null;
}
function goStep(n){
    step = n;
    modal.querySelectorAll('.ng-step').forEach(s => {
      s.hidden = Number(s.dataset.step) !== n;
    });
    modal.querySelectorAll('.ng-step-ind').forEach(ind => {
      ind.classList.toggle('ng-active', Number(ind.dataset.step) === n);
    });
    if(n === 1 && dateEl) dateEl.focus();
    if(n === 2) {
      const first = servicesListEl.querySelector('.ng-service-item');
      if(first) first.focus();
    }
    if(n === 3) renderConfirm();
  }
  function getServicesList(){
    const domBtns = Array.from(document.querySelectorAll('[data-reserve][data-service-name]'));
    if(domBtns.length){
      return domBtns.map((b,i) => ({ id:'dom-'+i, name: b.dataset.serviceName, price: Number(b.dataset.price||0) }));
    }
    return defaultServices.slice();
  }
  function renderServices(){
    servicesListEl.innerHTML = '';
    const services = getServicesList();
    services.forEach(svc=>{
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'ng-service-item';
      btn.setAttribute('aria-pressed', selected.has(svc.id) ? 'true' : 'false');
      btn.innerHTML = `<span class="ng-svc-name">${svc.name}</span><strong class="ng-svc-price">${fmt(svc.price)}</strong>`;
      btn.addEventListener('click', () => {
        if(selected.has(svc.id)) selected.delete(svc.id);
        else selected.set(svc.id, svc);
        btn.setAttribute('aria-pressed', selected.has(svc.id) ? 'true' : 'false');
        renderCart();
      });
      servicesListEl.appendChild(btn);
    });
  }
  function renderCart(){
    cartListEl.innerHTML = '';
    let total = 0;
    if(selected.size === 0){
      cartListEl.innerHTML = '<li style="opacity:.7">No hay servicios seleccionados</li>';
      cartTotalEl.textContent = '‚Äî';
      return;
    }
    selected.forEach(svc => {
      const li = document.createElement('li');
      li.innerHTML = `<span>${svc.name}</span><strong>${fmt(svc.price)}</strong>`;
      cartListEl.appendChild(li);
      total += Number(svc.price || 0);
    });
    cartTotalEl.textContent = fmt(total);
  }
  function renderConfirm(){
    const servicesHtml = Array.from(selected.values()).map(s => `<li>${s.name} ‚Äî ${fmt(s.price)}</li>`).join('');
    const total = Array.from(selected.values()).reduce((a,b) => a + Number(b.price || 0), 0);
    confirmEl.innerHTML = `
      <p><strong>Fecha:</strong> ${dateEl.value || '‚Äî'} &nbsp; <strong>Hora:</strong> ${timeEl.value || '‚Äî'}</p>
      <h4>Servicios</h4>
      <ul>${servicesHtml || '<li>No seleccionaste servicios</li>'}</ul>
      <p class="ng-cart-total">Total: <strong>${fmt(total)}</strong></p>
    `;
  }
  // store original actions HTML for step 3 so we can restore when modal closes
  const _ng_step3_actions = (function(){
    const s3 = modal.querySelector('.ng-step[data-step="3"] .ng-actions');
    return s3 ? s3.innerHTML : '';
  })();

  function confirmBooking(){
    // Show confirmation message but do NOT auto-close: require user action to close
    confirmEl.innerHTML = `<p><strong>¬°Listo! Tu cita ha quedado reservada. Por favor, llega a tiempo.</strong></p>`;
    // replace actions in step 3 with a single close button
    const actionsContainer = modal.querySelector('.ng-step[data-step="3"] .ng-actions');
    if(actionsContainer){
      actionsContainer.innerHTML = '';
      const closeBtn = document.createElement('button');
      closeBtn.type = 'button';
      closeBtn.className = 'ng-btn ng-btn-primary';
      closeBtn.textContent = 'Cerrar';
      closeBtn.setAttribute('data-ng-close', '');
      actionsContainer.appendChild(closeBtn);
    }
  }
  function bindTriggers(){
    const triggers = Array.from(document.querySelectorAll('[data-reserve], .reserve-btn, .reserve-link'));
    triggers.forEach(t => {
      t.addEventListener('click', (e) => {
        if(e.preventDefault) e.preventDefault();
        openModal(e.currentTarget);
      });
    });
  }
  modal.addEventListener('click', (e) => {
    if(e.target.closest('[data-ng-close]')) { closeModal(); return; }
    if(e.target.closest('[data-ng-cancel]')) { closeModal(); return; }
    if(e.target.closest('[data-ng-next]')) {
      if(step === 1) {
        if(!dateEl.value || !timeEl.value){ alert('Selecciona fecha y hora antes de continuar.'); return; }
        goStep(2); return;
      }
      if(step === 2) {
        if(selected.size === 0) { alert('Selecciona al menos un servicio.'); return; }
        goStep(3); return;
      }
    }
    if(e.target.closest('[data-ng-back]')) { goStep(Math.max(1, step - 1)); return; }
    if(e.target.closest('[data-ng-confirm]')) { confirmBooking(); return; }
  });
  overlay.addEventListener('click', closeModal);
  document.addEventListener('keydown', (e) => {
    if(modal.getAttribute('aria-hidden') === 'false' && e.key === 'Escape') closeModal();
  });
  bindTriggers();
  renderServices();
  renderCart();
})();
</script>

</body>
</html>